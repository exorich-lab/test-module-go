#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ Go –º–æ–¥—É–ª—è –Ω–∞ GitHub
# –¢—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ gh CLI –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

set -e

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ gh CLI
if ! command -v gh &> /dev/null; then
    echo "–û—à–∏–±–∫–∞: GitHub CLI (gh) –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ —Å https://cli.github.com/"
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
if ! gh auth status &> /dev/null; then
    echo "–û—à–∏–±–∫–∞: –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ GitHub CLI. –í—ã–ø–æ–ª–Ω–∏—Ç–µ 'gh auth login'"
    exit 1
fi

# –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–æ–¥—É–ª–µ
MODULE_NAME=$(go list -m)
VERSION=${1:-"v1.0.0"}

echo "–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –º–æ–¥—É–ª—è $MODULE_NAME –≤–µ—Ä—Å–∏–∏ $VERSION"

# –î–æ–±–∞–≤–ª—è–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
echo "–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è..."
git remote add origin https://github.com/$MODULE_NAME.git
git push -u origin main

# –°–æ–∑–¥–∞–µ–º —Ä–µ–ª–∏–∑
echo "–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ª–∏–∑–∞ $VERSION..."
gh release create $VERSION --title "Release $VERSION" --notes "–ü–µ—Ä–≤—ã–π —Ä–µ–ª–∏–∑ textutils –º–æ–¥—É–ª—è

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞ (–ø–æ–¥—Å—á–µ—Ç —Å–ª–æ–≤, —Å–∏–º–≤–æ–ª–æ–≤, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π, –∞–±–∑–∞—Ü–µ–≤)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–ª–∏–Ω–¥—Ä–æ–º–æ–≤
- –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ (–ø–µ—Ä–µ–≤–æ—Ä–æ—Ç, –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è)
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ email –∞–¥—Ä–µ—Å–æ–≤ –∏ URL
- –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –æ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
\`\`\`bash
go get $MODULE_NAME@$VERSION
\`\`\`

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
\`\`\`go
import \"$MODULE_NAME\"
\`\`\`"

echo "‚úÖ –ú–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –Ω–∞ GitHub!"
echo "üì¶ –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/$MODULE_NAME"
echo "üè∑Ô∏è –†–µ–ª–∏–∑: https://github.com/$MODULE_NAME/releases/tag/$VERSION"
echo "üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://pkg.go.dev/$MODULE_NAME@$VERSION"